function SaveSettings(e,t){var a=e+"="+t+";";document.cookie=a}function GetSettings(e){var t=document.cookie.match(new RegExp(e+"=([^;]+)"));return t?"true"===t[1]?!0:!1:null}function LoadSettings(e){CheckSettings(),e()}function CheckSettings(){GetSettings("showWeather")||(SaveSettings("showWeather",!1),SaveSettings("highlightSpawns",!1),SaveSettings("ShowTileNames",!1),SaveSettings("ShowSpawnPanel",!1),SaveSettings("QuickDropdownEscape",!1))}function DestroySettings(){document.cookie=null}!function(){"use strict";function e(){var e=$("#tile_all").is(":checked");T.y<C&&$("#tile_north").prop("checked",e),T.y>0&&$("#tile_south").prop("checked",e),T.x<C&&$("#tile_east").prop("checked",e),T.x>0&&$("#tile_west").prop("checked",e),t(),a(),n(),o()}function t(){if(T.y!==C){var e=T.y+1<=15;$("#tile_north").is(":checked")?($(T).addClass("north"),P.Nodes[T.x][T.y].N=!0,e&&(P.Nodes[T.x][T.y+1].S=!0,L(T.x,T.y+1).addClass("south"))):($(T).removeClass("north"),P.Nodes[T.x][T.y].N=!1,e&&(P.Nodes[T.x][T.y+1].S=!1,L(T.x,T.y+1).removeClass("south")))}}function a(){if(0!==T.y){var e=T.y-1>=0;$("#tile_south").is(":checked")?($(T).addClass("south"),P.Nodes[T.x][T.y].S=!0,e&&(P.Nodes[T.x][T.y-1].N=!0,L(T.x,T.y-1).addClass("north"))):($(T).removeClass("south"),P.Nodes[T.x][T.y].S=!1,e&&(P.Nodes[T.x][T.y-1].N=!1,L(T.x,T.y-1).removeClass("north")))}}function n(){if(T.x!==C){var e=T.x+1<=15;$("#tile_east").is(":checked")?($(T).addClass("east"),P.Nodes[T.x][T.y].E=!0,e&&(P.Nodes[T.x+1][T.y].W=!0,L(T.x+1,T.y).addClass("west"))):($(T).removeClass("east"),P.Nodes[T.x][T.y].E=!1,e&&(P.Nodes[T.x+1][T.y].W=!1,L(T.x+1,T.y).removeClass("west")))}}function o(){if(0!==T.x){var e=T.x-1>=0;$("#tile_west").is(":checked")?($(T).addClass("west"),P.Nodes[T.x][T.y].W=!0,e&&(P.Nodes[T.x-1][T.y].E=!0,L(T.x-1,T.y).addClass("east"))):($(T).removeClass("west"),P.Nodes[T.x][T.y].W=!1,e&&(P.Nodes[T.x-1][T.y].E=!1,L(T.x-1,T.y).removeClass("east")))}}function i(){P.Nodes[T.x][T.y].N===!0&&P.Nodes[T.x][T.y].S===!0&&P.Nodes[T.x][T.y].E===!0&&P.Nodes[T.x][T.y].W===!0?$("#tile_all").prop("checked",!0):$("#tile_all").prop("checked",!1)}function l(){c(!1,9,9,15,"radius");var e=parseInt($("#spawn_maxwander_distance > option:selected").val()),t=T.y+1,a=T.x+1;c(!0,a,t,e,"radius")}function r(){if(c(!1,9,9,15,"Allradius"),$("#highlightSpawns").is(":checked"))for(var e=C;e>=0;e--)for(var t=P.Nodes[e],a=0;a<t.length;a++){{var n=t[a];L(e,a)}if(n.Spawn){var o=n.Spawn.MaxWanderDistance,i=a+1,l=e+1;c(!0,l,i,o,"Allradius")}}}function s(){for(var e=C;e>=0;e--)for(var t=P.Nodes[e],a=0;a<t.length;a++){{var n=t[a];L(e,a)}if(1==n.Checkpoint){n.N&&C>=a+1&&L(e,a+1).addClass("protected"),n.S&&a-1>=0&&L(e,a-1).addClass("protected"),n.E&&C>=e+1&&L(e+1,a).addClass("protected"),n.W&&e-1>=0&&L(e-1,a).addClass("protected")}(1==n.Checkpoint||2==n.Checkpoint)&&L(e,a).addClass("protected")}}function c(e,t,a,n,o){for(var i=t-n-1;t+n>i;i++)for(var l=a-n-1;a+n>l;l++)i>=0&&15>=i&&l>=0&&15>=l&&(e?L(i,l).addClass(o):L(i,l).removeClass(o))}function d(){$("#server_command").val(""),$("#server_command_serverid").val(0),$("#server_commands").val(""),$("#server_command").focus()}function p(e,t,a){u();var n=t+1,o=a+1;$("#tile_x").text(n),$("#tile_y").text(o),$("#tile_name").val(e.Name),e.Name&&$("#header_tile_name").text(e.Name+" ["+n+","+o+"]"),$("#tile_north").prop("checked",e.N),$("#tile_south").prop("checked",e.S),$("#tile_east").prop("checked",e.E),$("#tile_west").prop("checked",e.W),$("#tile_north").is(":checked")&&$("#tile_south").is(":checked")&&$("#tile_east").is(":checked")&&$("#tile_west").is(":checked")?$("#tile_all").prop("checked",!0):$("#tile_all").prop("checked",!1),$("#portal_source_dungeonid").val(P.TemplateId),$("#portal_source_node_x").val(n),$("#portal_source_node_y").val(o),$("#portal_source_dungeonid").trigger("click"),$("#spawn_maxwander_distance").val(2),$("#tile_north").prop("disabled",a===C),$("#tile_south").prop("disabled",0===a),$("#tile_east").prop("disabled",t===C),$("#tile_west").prop("disabled",0===t),$("#addportal, #new_dungeon_save").prop("disabled",!1),$("#maptype").val(e.Map),$("#weathertype").val(e.Weather);var i=$("#weathertype option").eq(e.Weather).text();$("#tile_weather").prop("class",i),$("#point_type").val(e.Checkpoint),$("#tile_treasureroom").prop("checked",e.TreasureRoom);var l=0!=e.Checkpoint;if($("#checkpoint-list .selected").removeClass("selected"),1==l){var r="#cgo_r"+t+"c"+a;$(r).addClass("selected")}$("#portal_type").val(e.DefaultPortalType);var s=e.Portal;if($("#portal-list .btn").removeClass("selected"),e.IsPortal&&null!=s){$("#deleteportal").prop("disabled",!1),$("#portal_target_dungeonid").val(s.TargetDungeonId),$("#portal_target_dungeonid").trigger("change"),$("#portal_target_node_x").val(s.TargetNodeX+1),$("#portal_target_node_y").val(s.TargetNodeY+1);var r="#sgo_r"+t+"c"+a;$(r).addClass("selected"),$("#NodePortals").slideDown()}else $("#pinPortals").prop("checked")||$("#NodePortals").slideUp();$("#portal_target_dungeonid").trigger("change");var d=e.Spawn;if($("#SpawnList .selected").removeClass("selected"),null!=d){$("#spawn_is_disabled").prop("checked",d.isDisabled),$("#spawn_factiontype").val(d.Faction),$("#spawn_fighteraitype").val(d.AiType),$("#spawn_maxwander_distance").val(d.MaxWanderDistance),$("#spawn_leadername_override").val(d.LeaderNameOverride),$("#spawn_leaderrace").val(d.LeaderRaceOverride),$("#spawn_leadertype").val(d.LeaderTypeOverride),$("#spawn_minionname_override").val(d.MinionNameOverride),$("#spawn_minionrace").val(d.MinionRaceOverride),$("#delete_spawnpoint").prop("disabled",!1),$("#spawn_leadergender").val(d.LeaderSexOverride),$("#spawn_miniongender").val(d.MinionSexOverride),$("#spawn_kill_title").val(d.OnKillTitle),$("#spawn_kill_gatekey").val(d.OnKillGateKey),c(!1,9,9,15,"radius"),c(!0,n,o,d.MaxWanderDistance,"radius"),$("#SpawnPoints").slideDown();var r="#cgo_r"+t+"c"+a;$(r).addClass("selected")}else c(!1,9,9,15,"radius"),$("#pinSpawnPanel").prop("checked")||$("#SpawnPoints").slideUp()}function u(){$("#tile_x").text(""),$("#tile_y").text(""),$("#tile_name").val(""),$("#header_tile_name").text(""),$("#tile_north").prop("checked",!1),$("#tile_south").prop("checked",!1),$("#tile_east").prop("checked",!1),$("#tile_west").prop("checked",!1),$("#tile_all").prop("checked",!1),$("#maptype").val(0),$("#weathertype").val(0),$("#point_type").val(0),$("#tile_treasureroom").prop("checked",!1),$("#portal_target_dungeonid").val(""),$("#portal_target_node_x").val(""),$("#portal_target_node_y").val(""),$("#portal_source_dungeonid").val(""),$("#portal_source_node_x").val(""),$("#portal_source_node_y").val(""),$("#portal_type").val(1),$("#deleteportal").prop("disabled",!0),$("#spawn_is_disabled").prop("checked",!1),$("#spawn_factiontype").val(0),$("#spawn_fighteraitype").val(0),$("#spawn_maxwander_distance").val(0),$("#spawn_leadername_override").val(""),$("#spawn_leaderrace").val(0),$("#spawn_leadertype").val(0),$("#spawn_minionname_override").val(""),$("#spawn_minionrace").val(0),$("#delete_spawnpoint").prop("disabled",!0),$("#spawn_leadergender").val(0),$("#spawn_miniongender").val(0),$("#spawn_kill_title").val(""),$("#spawn_kill_gatekey").val("")}function g(e){return e.removeClass(),e}function v(){_("./Home/NewDungeon")}function h(){_("./Home/CopyDungeon")}function _(e){null!=T&&null!=P?confirm("Do you want to create a portal here and create this dungeon?")&&$.post(e,{dungeon:P,nodeX:T.x,nodeY:T.y}).done(function(e){T=null,dungeonJSON=JSON.parse(e),$("#dungeonselect").append($("<option></option>").attr("value",dungeonJSON.TemplateId).text(dungeonJSON.TemplateId+" - "+dungeonJSON.Name).prop("selected",!0)),m(),$(N).trigger("click")}).fail(function(e){O(e.responseText,!1)}):O("Error creating dungeon. Selected Node",!1)}function m(){if("undefined"!==dungeonJSON){P=dungeonJSON,b=[],$("#dungeon_name").val(P.Name),$("#header_name").text(P.Name),$("#dungeon_id").val(P.TemplateId),$("#dungeon_level").val(P.Level),$("#is_locked").prop("checked",P.IsLocked),$("#is_startingdungeon").prop("checked",P.IsStartingDungeon),$("#is_quicktravel").prop("checked",P.AlwaysQuickTravel),$("#WhiteList").val(P.AccessWhitelist),$("#GuildWhiteList").val(P.GuildWhitelist),$("#author_id").val(P.Author),$("#notes").val(P.Notes),$("#dungeon_region").val(P.Region),$("#dungeon_requiredgatekey").val(P.RequiredGateKey),$("#event_xp").prop("checked",P.EventXpBonus),$("#event_loot").prop("checked",P.EventLootBonus),$("#event_guild").prop("checked",P.EventGuildBonus),$("#portal-list").empty(),$("#checkpoint-list").empty(),$("#pvp_Arena_Level").val(P.ArenaMode),$("#dungeon_map_x").val(P.MapX),$("#dungeon_map_y").val(P.MapY),P.IsLocked?$("#WhiteListContainer").show():$("#WhiteListContainer").hide(),$("#TileNames").html(""),$("#SpawnList").html("");var e=$("#dungeon_report").prop("href"),t=e.substr(e.length-5);$("#dungeon_report").prop("href",e.replace(t,P.TemplateId)),$("#dungeon_report").text(function(){return $(this).text().replace(t,P.TemplateId)});for(var a=C;a>=0;a--)for(var n=P.Nodes[a],o=0;o<n.length;o++){var i=n[o],l=L(a,o);g(l),l.addClass("grid-tile north south east west");var c=$("#maptype option[value="+i.Map+"]").text();if(l.addClass(c),0===i.Weather&&(i.Weather=1),null==i.Name&&(i.Name="New Tile"),1===i.Weather&&l.addClass("normal"),2===i.Weather&&l.addClass("wet"),3===i.Weather&&l.addClass("cold"),4===i.Weather&&l.addClass("battle"),i.TreasureRoom&&l.addClass("treasure"),i.N||i.S||i.W||i.E){var d="sgo_r"+a+"c"+o;$("#TileNames").append('<div class="panel-row col-md-12"><p class="col-md-9">'+i.Name+'</p><input id="'+d+'" class="col-md-3 btn btn-default" type="button" value="['+(parseInt(a)+1)+","+(parseInt(o)+1)+']" /></div>'),function(e,t){$("#"+t).click(function(){e.trigger("click"),$("html, body").animate({scrollTop:0},200)})}(l,d)}if(i.IsPortal){l.addClass("portal");var v=$("#portal-list"),h="pgo_r"+a+"c"+o,d="sgo_r"+a+"c"+o,_="",w="#dungeonselect option[value='"+i.Portal.TargetDungeonId+"']";_=$(w).text().split(" - ")[1],_=_.replace("(locked)",""),v.append('<div class="panel-row col-md-12"><input id="'+h+'" class="col-md-9 btn btn-default" type="button" value="('+i.Portal.TargetDungeonId+") "+_+'" /><input id="'+d+'" class="col-md-3 btn btn-default" type="button" value="['+(a+1)+","+(o+1)+']" /></div>'),function(e,t,a,n){var o=n.Portal,i=L(o.TargetNodeX,o.TargetNodeY);$("#"+t).click(function(){T=null,u(),$.post("./Home/SelectDungeon",{id:o.TargetDungeonId},function(e){dungeonJSON=JSON.parse(e),m(),i.trigger("click"),$('#dungeonselect option:contains("'+o.TargetDungeonId+'")').prop("selected",!0),i.addClass("dest")})}),$("#"+a).click(function(){e.trigger("click"),$("html, body").animate({scrollTop:0},200)})}(l,h,d,i)}if(0!=i.Checkpoint){var k="";1==i.Checkpoint&&(l.addClass("checkpoint"),l.removeClass("respawn"),k="checkpoint"),2==i.Checkpoint&&(l.addClass("respawn"),l.removeClass("checkpoint"),k="respawn");var y=$("#checkpoint-list"),x="cgo_r"+a+"c"+o;y.append('<div class="panel-row col-md-12"><p class="col-xs-3 col-md-3">['+(a+1)+","+(o+1)+']</p><p class="col-xs-5 col-md-5">'+k+'</p><input id="'+x+'" class="col-md-4 col-xs-4 btn btn-default" type="button" value="Select" /></div>'),function(e,t){$("#"+t).click(function(){e.trigger("click"),$("html, body").animate({scrollTop:0},200)})}(l,x)}if(i.N||l.removeClass("north"),i.S||l.removeClass("south"),i.E||l.removeClass("east"),i.W||l.removeClass("west"),null!=i.Spawn){l.addClass("spawn");var y=$("#SpawnList"),x="cgo_r"+a+"c"+o,S=function(e){switch(e){case 1:return"Minion";case 2:return"Officer";case 3:return"Leader";case 4:return"Deity";default:return"unknown"}},N="",D="#spawn_factiontype option[value='"+i.Spawn.Faction+"']";N=$(D).text(),y.append('<div class="panel-row col-md-12"><p class="col-md-6">'+N+'</p><p class="col-md-3">'+S(i.Spawn.AiType)+'</p><input id="'+x+'" class="col-md-3 btn btn-default" type="button" value="['+(a+1)+","+(o+1)+']" /></div>'),function(e,t){$("#"+t).click(function(){e.trigger("click"),$("html, body").animate({scrollTop:0},200)})}(l,x)}l.attr("data-toggle","tooltip").attr("data-placement","right").attr("title",i.Name+" ["+(a+1)+","+(o+1)+"]"),function(e,t,a){$(l).off("click").click(function(n){n.preventDefault(),null!=T&&(f(T),T.removeClass("active"));var o=$(this);p(e,t,a),T=o,T.addClass("active"),T.x=t,T.y=a})}(i,a,o),b.push([l,a,o])}return r(),s(),$(T).trigger("click"),P}}function f(e){if("undefined"!==P){var t=P.Nodes[e.x][e.y];t.E=$("#tile_east").prop("checked"),t.Checkpoint=$("#point_type").val(),t.TreasureRoom=$("#tile_treasureroom").prop("checked"),t.Map=$("#maptype").val(),t.N=$("#tile_north").prop("checked"),t.Name=$("#tile_name").val(),t.S=$("#tile_south").prop("checked"),t.W=$("#tile_west").prop("checked"),t.Weather=$("#weathertype").val(),t.DefaultPortalType=$("#portal_type").val()}}function w(e){if("undefined"!==P&&confirm("Are you sure you want to save this dungeon?")){f(T),P.Name=$("#dungeon_name").val(),P.TemplateId=$("#dungeon_id").val(),P.Level=$("#dungeon_level").val(),P.IsLocked=$("#is_locked").prop("checked"),P.AlwaysQuickTravel=$("#is_quicktravel").prop("checked"),P.IsStartingDungeon=$("#is_startingdungeon").prop("checked"),P.AccessWhitelist=$("#WhiteList").val(),P.GuildWhitelist=$("#GuildWhiteList").val(),P.Author=$("#author_id").val(),P.Notes=$("#notes").val(),P.Region=$("#dungeon_region").val(),P.EventXpBonus=$("#event_xp").prop("checked"),P.EventLootBonus=$("#event_loot").prop("checked"),P.EventGuildBonus=$("#event_guild").prop("checked"),P.RequiredGateKey=$("#dungeon_requiredgatekey").val(),P.ArenaMode=$("#pvp_Arena_Level").val(),P.MapX=$("#dungeon_map_x").val(),P.MapY=$("#dungeon_map_y").val(),$('#dungeonselect option:contains("'+P.TemplateId+'")').text(dungeonJSON.TemplateId+" - "+dungeonJSON.Name).prop("selected",!0);var t="./Home/SaveDungeon";$.ajax({url:t,type:"post",dataType:"json",data:P,success:function(t){e?$.get("./Home/Publish",function(e){O("Publish Complete!",!0)}):O("Save Complete",!0),dungeonJSON=t,m()},error:function(e){O(e.responseText,!1)}})}}function k(){var e=0;D[0]="ID, Name, Region, Locked, lvl, Author",$("#dungeonselect > option").each(function(t){var a=$(this).val(),n="./Home/SelectDungeon";$.post(n,{id:a},function(t){e++;var n;n=JSON.parse(t),D[e]=a+","+n.Name+","+n.Region+","+n.IsLocked+","+n.Level+","+n.Author})}),D.forEach(function(e,t){y=D.join("\n")}),$("#Export").prop("href","data:text/csv;charset=utf-8,"+encodeURIComponent(y)),$("#Export").prop("download","Dungeons.csv"),$("#Export").prop("style","")}var y,x=function(e,t){this.TargetDungeonId="",this.TargetNodeX=0,this.TargetNodeY=0,this.SourceNode=e,this.SelectedNode=t},S=function(e,t){this.DungeonTemplateId=e,this.NodeX=t.x,this.NodeY=t.y,this.isDisabled=!1,this.DireFaction=0,this.FighterAiType=0,this.MaxWanderDistance=0,this.LeaderNameOverride="",this.LeaderRaceOverride=0,this.LeaderTypeOverride=0,this.LeaderSexOverride=0,this.MinionNameOverride="",this.MinionRaceOverride=0,this.MinionSexOverride=0,this.OnKillTitle="",this.OnKillGateKey=""},N="#r8c8",C=15,T=null,b=[],D=[],L=function(e,t){return $("#r"+e+"c"+t)},O=function(e,t){$(".server_message").text(""),$(".server_message").text(e),$("#msgModal").modal(),t&&setTimeout(function(){$("#msgModal").modal("hide")},1500)},W=function(e,t){return $(e).val(t).text()};if("undefined"!=typeof dungeonJSON){var P=m();W("#portaltype",2),$(N).trigger("click"),$('#dungeonselect option:contains("'+P.TemplateId+'")').prop("selected",!0),$("#tile_north").click(function(){t(),i()}),$("#tile_south").click(function(){a(),i()}),$("#tile_east").click(function(){n(),i()}),$("#tile_west").click(function(){o(),i()}),$("#tile_all").click(function(){e()}),$(document).keydown(function(e){if(!($("input:focus").length>0||$("textarea:focus").length>0||!$("#QuickDropdownEscape").is(":checked")&&$("select:focus").length>0)){var t,a;if(e.shiftKey)switch(e.keyCode){case 37:$("#tile_west").trigger("click");break;case 38:$("#tile_north").trigger("click");break;case 39:$("#tile_east").trigger("click");break;case 40:$("#tile_south").trigger("click");break;case 13:$("#tile_all").trigger("click");break;case 46:e.preventDefault(),$("#Nullify-AllTile").trigger("click");break;case 35:e.preventDefault(),$("#paste-AllTile").trigger("click");break;case 36:e.preventDefault(),$("#copy-AllTile").trigger("click")}else if(!e.shiftKey&&null!=T&&T.x>=0&&T.x<=15&&T.y<=15&&T.y>=0)switch(t=T.x,a=T.y,e.keyCode){case 37:e.preventDefault(),t--,$("#r"+t+"c"+a).trigger("click");break;case 38:e.preventDefault(),a++,$("#r"+t+"c"+a).trigger("click");break;case 39:e.preventDefault(),t++,$("#r"+t+"c"+a).trigger("click");break;case 40:e.preventDefault(),a--,$("#r"+t+"c"+a).trigger("click");break;case 46:e.preventDefault(),$("#Nullify-AllTile").trigger("click");break;case 35:e.preventDefault(),$("#paste-AllTile").trigger("click");break;case 36:e.preventDefault(),$("#copy-AllTile").trigger("click")}if($("#useWASD").is(":checked")&&e.shiftKey&&null!=T&&T.x>=0&&T.x<=15&&T.y<=15&&T.y>=0)switch(t=T.x,a=T.y,e.keyCode){case 65:e.preventDefault(),t--,$("#r"+t+"c"+a).trigger("click");break;case 87:e.preventDefault(),a++,$("#r"+t+"c"+a).trigger("click");break;case 68:e.preventDefault(),t++,$("#r"+t+"c"+a).trigger("click");break;case 83:e.preventDefault(),a--,$("#r"+t+"c"+a).trigger("click")}}}),$("#maptype").change(function(){$("#maptype > option").each(function(){$(T).removeClass(this.text)});var e=$("#maptype option:selected");$(T).addClass(e.text()),P.Nodes[T.x][T.y].Map=Number(e.val())}),$("#weathertype").change(function(){var e=$("#weathertype option:selected");$("#tile_weather").prop("class",$("#weathertype option:selected").text()),P.Nodes[T.x][T.y].Weather=Number(e.val()),T.removeClass("normal"),T.removeClass("wet"),T.removeClass("cold"),T.removeClass("battle"),1===Number(e.val())&&T.addClass("normal"),2===Number(e.val())&&T.addClass("wet"),3===Number(e.val())&&T.addClass("cold"),4===Number(e.val())&&T.addClass("battle")}),$("#save").click(function(e){e.preventDefault(),w(!1)}),$("#openmap").click(function(){OpenNodes()}),$("#dungeonselect").change(function(){var e=$("#dungeonselect option:selected").val(),t="./Home/SelectDungeon";T=null,u(),$.post(t,{id:e},function(e){dungeonJSON=JSON.parse(e),m(),$(N).trigger("click"),$("#dungeonselect").blur()})}),$("#authorselect").change(function(){var e=$("#authorselect option:selected").val();$("#dungeonselect").children("option").show(),$("#regionselect").prop("selectedIndex",0),""!=e&&($("#dungeonselect").children("option").hide(),$("#dungeonselect").children('option[data-author^="'+e+'"]').show(),$("#dungeonselect").prop("selectedIndex",-1).val("Select Your Dungeon"))}),$("#regionselect").change(function(){var e=$("#regionselect option:selected").val();$("#dungeonselect").children("option").show(),$("#authorselect").prop("selectedIndex",0),""!=e&&($("#dungeonselect").children("option").hide(),$("#dungeonselect").children('option[data-region^="'+e+'"]').show(),$("#dungeonselect").prop("selectedIndex",-1).val("Select Your Dungeon"))}),$("#point_type").change(function(){var e=$("#point_type option:selected").val();P.Nodes[T.x][T.y].Checkpoint=e,0!=e?(1==e?($(T).addClass("checkpoint"),$(T).removeClass("respawn"),P.Nodes[T.x][T.y].N&&T.y+1<=C&&L(T.x,T.y+1).addClass("protected"),P.Nodes[T.x][T.y].S&&T.y-1>=0&&L(T.x,T.y-1).addClass("protected"),P.Nodes[T.x][T.y].E&&T.x+1<=C&&L(T.x+1,T.y).addClass("protected"),P.Nodes[T.x][T.y].W&&T.x-1>=0&&L(T.x-1,T.y).addClass("protected")):($(T).addClass("respawn"),$(T).removeClass("checkpoint")),L(T.x,T.y).addClass("protected")):($(T).removeClass("checkpoint"),$(T).removeClass("respawn"),T.y+1<=C&&L(T.x,T.y+1).removeClass("protected"),T.y-1>=0&&L(T.x,T.y-1).removeClass("protected"),T.x+1<=C&&L(T.x+1,T.y).removeClass("protected"),T.x-1>=0&&L(T.x-1,T.y).removeClass("protected"),L(T.x,T.y).removeClass("protected"))}),$("#tile_treasureroom").change(function(){var e=$("#tile_treasureroom").is(":checked");e?L(T.x,T.y).addClass("treasure"):L(T.x,T.y).removeClass("treasure")}),$("#server_commands").change(function(){var e=$("#server_commands option:selected").val();""!=e?($("#server_command").val(e+" "),$("#server_command").focus()):d()}),$("#add_spawnpoint").click(function(e){e.preventDefault();var t=$("#spawn_factiontype option:selected").val(),a=$("#spawn_leadername_override").val(),n=$("#spawn_minionname_override").val();if(0==t)return void O("You must specify a Faction for this Spawn Point",!1);var o=new S($("#dungeon_id").val(),T);o.FighterAiType=$("#spawn_fighteraitype").val(),o.DireFaction=t,o.isDisabled=$("#spawn_is_disabled").prop("checked"),o.MaxWanderDistance=$("#spawn_maxwander_distance").val(),o.LeaderNameOverride=$.trim(a),o.LeaderRaceOverride=$("#spawn_leaderrace").val(),o.LeaderTypeOverride=$("#spawn_leadertype").val(),o.LeaderSexOverride=$("#spawn_leadergender").val(),o.MinionNameOverride=$.trim(n),o.MinionRaceOverride=$("#spawn_minionrace").val(),o.MinionSexOverride=$("#spawn_miniongender").val(),o.OnKillTitle=$("#spawn_kill_title").val(),o.OnKillGateKey=$("#spawn_kill_gatekey").val();var i="./Home/CreateSpawnPoint";$.post(i,{dungeon:P,spawnpoint:o}).done(function(e){dungeonJSON=JSON.parse(e),m(),O("Spawn Point Complete!",!0)}).fail(function(e){O(e.responseText,!1)})}),$("#delete_spawnpoint").click(function(e){if(e.preventDefault(),null==P||null!=P.Nodes[T.x][T.y].Spawn){var t="./Home/DeleteSpawnPoint";c(!1,T.x,T.y,15,"radius"),$.post(t,{dungeon:P,nodeX:T.x,nodeY:T.y}).done(function(e){dungeonJSON=JSON.parse(e),m(),O("Spawn Point Removed!",!0)}).fail(function(e){O(e.responseText,!1)})}}),$("#addportal").click(function(e){e.preventDefault();var t=$("#portal_target_dungeonid").val(),a=$("#portal_target_node_x").val(),n=$("#portal_target_node_y").val(),o=$("#portal_source_dungeonid").val(),i=$("#portal_source_node_x").val(),l=$("#portal_source_node_y").val();if(""==o||""==i||""==l)return void O("You must specify a source dungeon and coordinates",!1);if(""==t||""==a||""==n)return void O("You must specify a target dungeon and coordinates",!1);var r={DungeonId:$("#dungeon_id").val(),X:T.x,Y:T.y},s={DungeonId:o,X:i-1,Y:l-1},c=new x(s,r);c.TargetDungeonId=t,c.TargetNodeX=a-1,c.TargetNodeY=n-1;var d="./Home/CreatePortal";$.post(d,{dungeon:P,portaldrop:c}).done(function(e){dungeonJSON=JSON.parse(e),m(),O("Portal Complete!",!0)}).fail(function(e){O(e.responseText,!1)})}),$("#deleteportal").click(function(e){if(e.preventDefault(),null==P||P.Nodes[T.x][T.y].IsPortal){var t="./Home/DeletePortal";$.post(t,{dungeon:P,nodeX:T.x,nodeY:T.y}).done(function(e){dungeonJSON=JSON.parse(e),m(),O("Portal Link Removed!",!0)}).fail(function(e){O(e.responseText,!1)})}}),$("#jumpportal").click(function(e){O("Jump!",!0)}),$("#randomname").click(function(e){e.preventDefault();var t=$("#maptype option:selected").text(),a=$("#weathertype option:selected").text();t="NULL"==t.toUpperCase()?"Dungeon":t,a="NULL"==a.toUpperCase()?"Normal":a,$.get("./Home/RandomTileName",{maptype:t,weathertype:a}).done(function(e){$("#tile_name").val(e),f(T)})})}$("#spawn_maxwander_distance").change(function(e){l()}),$("#spawn_maxwander_distance").click(function(e){l()}),$("#spawn_factiontype").click(function(e){l()}),$("#spawn_fighteraitype").click(function(e){l()}),$("#highlightSpawns").change(function(e){r(),SaveSettings("highlightSpawns",$(this).prop("checked"))}),$("#delete_dungeon").click(function(e){if(e.preventDefault(),null!=P){if(confirm("!!!WARNING!!!\nAre you sure you want to remove "+P.Name+" ("+P.TemplateId+")?\nChange will be saved out to game files!")){var t="./Home/DeleteDungeon",a=P.TemplateId;$.post(t,{dungeonid:a}).done(function(e){T=null,dungeonJSON=JSON.parse(e),$("#dungeonselect option[value='"+a+"']").remove(),m(),$(N).trigger("click")}).fail(function(e){O(e.responseText,!1)})}}else O("Error trying to delete dungeon!",!1)}),$("#confirm_publish").click(function(e){e.preventDefault(),w(!0)}),$("#auth_newdungeon, #auth_copydungeon").click(function(e){e.preventDefault();var t=$("#new_auth_username").val(),a=$("#new_auth_password").val(),n=$(this);$.get("./Home/DungeonMaster",{user:t,pass:a}).done(function(e){"ok"==e?($("#newDungeonModal").modal("toggle"),"auth_newdungeon"==n.attr("id")?v():"auth_copydungeon"==n.attr("id")&&h()):O("Could not authorize, Try Again",!1)}),$("#new_auth_username").val(""),$("#new_auth_password").val("")}),$("#sendcommand").click(function(e){e.preventDefault();var t=$("#server_command").val(),a=$("#server_command_serverid").val();if(t=$.trim(t),""==t)return void O("You must enter a command before hitting submit",!1);var n="./Home/ServerCommand";$.post(n,{command:t,serverid:a}).done(function(e){"Success"==e&&(O("Command Sent",!0),d())}).fail(function(e){O(e.responseText,!1)})}),$("#clearcommand").click(function(){d()}),$("#generatecsv").click(function(){k()})}(),$(document).ready(function(){function e(){$("#reOrderPanels").prop("checked")?($(".inspector").sortable({placeholder:"ui-state-highlight"}),$(".inspector").disableSelection(),$(".leftcolumn").sortable({placeholder:"ui-state-highlight"}),$(".leftcolumn").disableSelection()):($(".inspector").sortable({cancel:".panel"}),$(".inspector").enableSelection(),$(".leftcolumn").sortable({cancel:".panel"}),$(".leftcolumn").enableSelection())}function t(){$("#TileNamesList").slideToggle($("#ShowTileNames").is(":checked"))}function a(){$("#SpawnListContainer").slideToggle($("#ShowSpawnPanel").is(":checked"))}function n(){$("#tile_name").val()&&(L=$("#tile_name").val())}function o(){L&&($("#tile_name").val(L),$("#tile_name").trigger("change"))}function i(){$("#maptype").val()&&(O=$("#maptype").val())}function l(){O&&($("#maptype").val(O),$("#maptype").trigger("change"))}function r(){$("#portal_type").val()&&(P=$("#portal_type").val())}function s(){P&&($("#portal_type").val(P),$("#portal_type").trigger("change"))}function c(){$("#weathertype").val()&&(W=$("#weathertype").val())}function d(){W&&($("#weathertype").val(W),$("#weathertype").trigger("change"))}function p(){f=$("#spawn_is_disabled").val(),w=$("#spawn_fighteraitype").val(),k=$("#spawn_factiontype").val(),y=$("#spawn_maxwander_distance").val(),x=$("#spawn_leadername_override").val(),S=$("#spawn_leaderrace").val(),N=$("#spawn_leadertype").val(),C=$("#spawn_leadergender").val(),T=$("#spawn_minionname_override").val(),b=$("#spawn_minionrace").val(),D=$("#spawn_miniongender").val()}function u(){f&&($("#spawn_is_disabled").val(f),$("#spawn_is_disabled").trigger("change")),w&&($("#spawn_fighteraitype").val(w),$("#spawn_fighteraitype").trigger("change")),k&&($("#spawn_factiontype").val(k),$("#spawn_factiontype").trigger("change")),y?($("#spawn_maxwander_distance").val(y),$("#spawn_maxwander_distance").trigger("change")):($("#spawn_maxwander_distance").val(2),$("#spawn_maxwander_distance").trigger("change")),x&&($("#spawn_leadername_override").val(x),$("#spawn_leadername_override").trigger("change")),S&&($("#spawn_leaderrace").val(S),$("#spawn_leaderrace").trigger("change")),N&&($("#spawn_leadertype").val(N),$("#spawn_leadertype").trigger("change")),C&&($("#spawn_leadergender").val(C),$("#spawn_leadergender").trigger("change")),T&&($("#spawn_minionname_override").val(T),$("#spawn_minionname_override").trigger("change")),b&&($("#spawn_minionrace").val(b),$("#spawn_minionrace").trigger("change")),D&&($("#spawn_miniongender").val(D),$("#spawn_miniongender").trigger("change"))}function g(){if($(".ui-selected").hasClass("spawn")||$(".active").hasClass("spawn"))I("You can't Nullify this tile while it has a spawn on it!",!1);else{if($(".ui-selected").hasClass("portal")||$(".active").hasClass("portal"))return void I("You can't Nullify this tile while it has a portal!",!1);$("#tile_name").val("NULL"),$("#tile_name").trigger("change"),$("#maptype").val("NULL"),$("#maptype").trigger("change"),$("#portal_type").val("NULL"),$("#portal_type").trigger("change"),$("#weathertype").val("NULL"),$("#weathertype").trigger("change"),$("#spawn_is_disabled").val(f),$("#spawn_is_disabled").trigger("change"),$("#is_checkpoint").prop("checked",!0),$("#is_checkpoint").trigger("click"),$("#tile_north").is(":disabled")||($("#tile_north").prop("checked",!0),$("#tile_north").trigger("click")),$("#tile_south").is(":disabled")||($("#tile_south").prop("checked",!0),$("#tile_south").trigger("click")),$("#tile_east").is(":disabled")||($("#tile_east").prop("checked",!0),$("#tile_east").trigger("click")),$("#tile_west").is(":disabled")||($("#tile_west").prop("checked",!0),$("#tile_west").trigger("click")),$(".active").addClass("NULL")}}function v(){$("#showWeather").prop("checked")?$(".dungeongrid").addClass("showWeather"):$(".dungeongrid").removeClass("showWeather")}function h(){var e=$("#portal_source_dungeonid").val();$("#sourceDungeonName").html(m(e))}function _(){var e=$("#portal_target_dungeonid").val();$("#targetDungeonName").html(m(e))}function m(e){var t="",a="#dungeonselect option[value='"+e+"']";return t=$(a).text(),t?(t=t.split(" - ")[1],t=t.replace("(locked)","")):" "}var f,w,k,y,x,S,N,C,T,b,D,L="",O="",W="",P="",I=function(e,t){$(".server_message").text(""),$(".server_message").text(e),$("#msgModal").modal(),t&&setTimeout(function(){$("#msgModal").modal("hide")},1500)};$("#reOrderPanels").click(function(){e(),SaveSettings("reOrderPanels",$("#reOrderPanels").prop("checked"))}),$("#reOrderPanels").change(function(){e(),SaveSettings("reOrderPanels",$("#reOrderPanels").prop("checked"))}),$("#LegendHeader").click(function(){$("#LegendBody").slideToggle()}),$("#PortalsHeader").click(function(){$("#Portals").slideToggle()}),$("#CheckpointsHeader").click(function(){$("#Checkpoints").slideToggle()}),$("#GuildHallsHeader").click(function(){$("#GuildHalls").slideToggle()}),$("#TogglesHeader").click(function(){$("#TogglesBody").slideToggle()}),$("#ShowTileNames").change(function(){t(),SaveSettings("ShowTileNames",$("#ShowTileNames").prop("checked"))}),$("#ShowSpawnPanel").change(function(){a(),SaveSettings("ShowSpawnPanel",$("#ShowSpawnPanel").prop("checked"))}),$("#TileNamesHeader").click(function(){$("#TileNames").slideToggle()}),$("#SpawnListHeader").click(function(){$("#SpawnList").slideToggle()}),v(),$("#DisplaySettings").click(function(){$("#SettingsModal").modal("toggle")}),$("#DungeonPropertiesHeader").click(function(){$("#DungeonProperties").slideToggle()}),$("#TileInspectorHeader").click(function(){$("#TileInspector").slideToggle()}),$("#NodePortalsHeader").click(function(){$("#pinPortals").prop("checked")?$("#NodePortals").show():$("#NodePortals").slideToggle()}),$("#SpawnPointsHeader").click(function(){$("#pinSpawnPanel").prop("checked")?$("#SpawnPoints").show():$("#SpawnPoints").slideToggle()}),$("#WhiteListHeader").click(function(){$("#WhiteListBody").slideToggle()}),$("#GuildListPanelHeader").click(function(){$("#GuildListBody").slideToggle()}),$("#CommandsHeader").click(function(){$("#Commands").slideToggle()}),$("#EventsHeader").click(function(){$("#Events").slideToggle()}),$("#is_locked").click(function(e){$("#is_locked").prop("checked")?$("#WhiteListContainer").show():$("#WhiteListContainer").hide()}),$("#copy-TileName").click(function(e){n()}),$("#paste-TileName").click(function(e){o()}),$("#copy-MapType").click(function(e){i()}),$("#paste-MapType").click(function(e){l()}),$("#copy-PortalType").click(function(e){r()}),$("#paste-PortalType").click(function(e){s()}),$("#copy-TileWeather").click(function(e){c()}),$("#paste-TileWeather").click(function(e){d()}),$("#copy-TileWalls").click(function(e){CopyTileWalls()}),$("#paste-TileWalls").click(function(e){PasteTileWalls()}),$("#paste-AllTile").click(function(e){o(),l(),s(),d()}),$("#copy-AllTile").click(function(e){n(),i(),r(),c()}),$("#copy-AllSpawn").click(function(e){p()}),$("#paste-AllSpawn").click(function(e){u()}),$("#Nullify-AllTile").click(function(e){g()}),$("#showWeather").change(function(e){v(),SaveSettings("showWeather",$(this).prop("checked"))}),$("#showSpawns").change(function(e){toggleSpawns()}),$("#portal_source_dungeonid").blur(function(e){h()}),$("#portal_source_dungeonid").change(function(e){h()}),$("#portal_source_dungeonid").click(function(e){h();

}),$("#portal_target_dungeonid").blur(function(e){_()}),$("#portal_target_dungeonid").change(function(e){_()}),$("#portal_target_dungeonid").click(function(e){_()}),$("#QuickDropdownEscape").change(function(){SaveSettings("QuickDropdownEscape",$(this).prop("checked"))}),LoadSettings(function(){$("#showWeather").prop("checked",GetSettings("showWeather")),$("#highlightSpawns").prop("checked",GetSettings("highlightSpawns")),$("#QuickDropdownEscape").prop("checked",GetSettings("QuickDropdownEscape")),$("#showWeather").trigger("change"),$("#highlightSpawns").trigger("change"),$("#QuickDropdownEscape").trigger("change")}),$(document).ready(function(){var e=$("#maptype"),t=e.val(),a=e.find("option");a.sort(function(e,t){return $(e).text()>$(t).text()?1:-1}),e.html("").append(a),$('#maptype option[value="0"]').prependTo(e),e.val(t)})});